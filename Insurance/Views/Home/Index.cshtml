@model IEnumerable<Insurance.Model.Client>

<!DOCTYPE html>
<html lang="en">

<head>
    <title>Get Har</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo&Josefin+Sans&family=Quicksand&display=swap" rel="stylesheet">


    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.4/css/buttons.dataTables.min.css" />

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/site.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">

</head>

<body>

    <div class="container-fluid">

        <span><img src="~/images/Vector1.png" alt="image" class="vector_img" /></span>
        <span><img src="~/images/Saly-2.png" alt="image" class="saly2" /></span>
        <span><img src="~/images/Saly-15.png" alt="image" class="sally15" /></span>
        <span><img src="~/images/logo.png" alt="image" class="logo_img" /></span>
        <div class="text-center align-center">

            <ul class="top_nav">
                <li> <a href="/">Home</a></li>
                <li> <a href="/Home/Contact">Contact</a></li>
            </ul>

        </div>

        <div class="row top_row">
            <div class="col-md-4 col-lg-3"> </div>

            <div class="col-md-4 col-lg-4">
            </div>

            <div class="col-md-3 col-lg-3">
            </div>

            <div class="col-md-1 col-lg-1"></div>
        </div>

        <div class="row">
            <div class="col-md-1 col-lg-1"></div>

            <div class="jumbotron  col-md-11 col-xs-12 col-lg-11">

                <div class="text-center ">
                    <b>View information</b>
                </div>

                <div class="row row-padding">
                    <div class="col-12">
                        <div class="card">

                            <div class="card-body">
                                <table id="records_table" class=" table-responsive  nowrap w-100 table-bordered  table-striped ">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>
                                                Details
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model => model.Dob)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model => model.DateOfIssue)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model => model.Id)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model => model.Name)
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>
                                                    <a href="#" client_id="@item.Id" class="delete"> <img src="~/icons/delete.png" /> </a>
                                                </td>
                                                <td>
                                                    @if (item.ExcellFile != null)
                                                    {
                                                        <a href="@item.ExcellFile"> <img src="~/icons/excel.png" /> </a>
                                                    }
                                                    @if (item.CarFile != null)
                                                    {
                                                        <a href="@item.CarFile"> <img src="~/icons/car.png" /> </a>
                                                    }
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Dob)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.DateOfIssue)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Id)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Name)
                                                </td>
                                                <td>
                                                    @if (item.HasPartner)
                                                    {
                                                        <img src="~/icons/users.png" />
                                                    }
                                                    else
                                                    {
                                                        <img src="~/icons/user.png" />
                                                    }

                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>


            </div>
            <div class="col-md-1 col-lg-1"></div>
        </div>

        @Html.Partial("CreatePartial")


    </div>

    <div class="col-md-1 col-lg-1"></div>


    <div class="rectangles">

        <span class="">
            <img src="images/rectanges.png" alt="image" class="rectangles_hanging">
        </span>
    </div>

    <div class="footer1">
    </div>
    <div class="footer2">
    </div>



    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.min.js"></script>

    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>

    <form id="delete_form" action="/Home/Delete" method="post">
        <input type="hidden" name="Id" id="delete_hidden" />
    </form>







    <script>

        function add_cars_fields() {
            var car_holders = $("#car_holders").html();

            var car_new =
                `<p><div class="row form-inputs">
                    <label class="col-sm-2 control-label"> Car Number: </label>
                    <div class="col-sm-4">
                        <input class="form-control cars" type="text" value="">
                    </div>
                </div></p>`;

            $("#car_holders").html(car_holders + car_new);
        }

        function add_spouse_cars_fields(){
            var car_holders = $("#spouse_car_holders").html();

            var car_new =
                `<p><div class="row form-inputs">
                    <label class="col-sm-2 control-label"> Car Number: </label>
                    <div class="col-sm-4">
                        <input class="form-control spouse_cars" type="text" value="">
                    </div>
                </div></p>`;

            $("#spouse_car_holders").html(car_holders + car_new);
        }

        function add_child_fields() {

            var child_holders = $("#child_holders").html();

            var child_new =
                `<div class="row form-inputs children">
                    <label class="col-sm-2 control-label">Child Id: </label>
                    <div class="col-sm-4">
                        <input class="form-control child_id" type="text" value="">
                    </div>

                        <label class="col-sm-2 control-label">Birth: </label>
                        <div class="col-sm-4">
                            <input class="form-control child_dob" type="date" value="">
                        </div>
                </div>`;


            $("#child_holders").html(child_holders + child_new);
        }



        $(function () {

            $(".delete").click(function (e) {
                if (confirm("Are you sure you want to delete this client")) {
                    let id = $(this).attr("client_id");
                    $("#delete_hidden").val(id);
                    $("#delete_form").submit();
                }
            });


            $('#records_table').DataTable({
                order: [
                    [1, 'asc']
                ],
            });


            $("#submit").click(function () {

                let cars=[];
                let spouse_cars=[];

                $(".cars").each(function () {
                    cars.push($(this).val())
                });

                $(".spouse_cars").each(function () {
                    spouse_cars.push($(this).val())
                });

                let data={
                    name:   $("#private").val()+" "+$("#family").val(),
                    id:     $("#id_number").val(),
                    issued: $("#date_issued").val(),
                    dob:    $("#dob").val(),
                    cars:   cars,
                    spouseName:   $("#spouse_private").val()+" "+$("#spouse_family").val(),
                    spouseId:     $("#spouse_id_number").val(),
                    spouseIssued: $("#spouse_date_issued").val(),
                    spouseDob:    $("#spouse_dob").val(),
                    spouseCars:   spouse_cars
                };

                 fetch("/", {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "/",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        if (response == true) {
                            window.location = "/";
                        }
                    }
                });

            });

        });



    </script>
</body>
</html>
